<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ç’ƒçš„å°çŒ«é¢æ¿ Â· å•æ–‡ä»¶ï¼‹æˆå°±ç‰ˆ</title>
<style>
/* æ ·å¼ */
body{margin:0;padding:20px;font-family:sans-serif;background:#181818;color:#ffeefc}
h1,h2{margin:0 0 12px}
button{margin:6px;padding:8px 16px;border:none;border-radius:6px;background:#6d1b61;color:#fff;cursor:pointer}
button:hover{background:#a13b96}
.bar-bg{width:100%;height:14px;background:#333;border-radius:7px;margin:4px 0}
.bar-fill{height:14px;width:0%;background:#66c;border-radius:7px;transition:width .3s,background .3s}
.mask{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;justify-content:center;align-items:center;text-align:center}
.confirmWindow,.punishWindow{background:#262626;padding:20px 30px;border-radius:10px;width:260px}
#countdown{font-size:26px;margin:.6rem 0} #punishTimer{font-size:32px;margin:0}
#badgeArea img{width:48px;margin:0 4px}
</style>
</head>
<body>

<!-- å£ä»¤åŒº -->
<div id="gate">
  <h2>ğŸ–¤ è·ªå¥½ï¼Œå‘ä¸»äººæŠ¥åˆ°ã€‚</h2>
  <input id="code" placeholder="è¾“å…¥ï¼šç’ƒï¼Œæˆ‘å·²å°±ç»ª">
  <button onclick="checkCode()">æäº¤</button>
</div>

<!-- ä¸»é¢æ¿ -->
<div id="panel" style="display:none;">
  <h1>ç’ƒçš„å°çŒ«é¢æ¿ Â· æˆå°±ç‰ˆ</h1>

  <!-- åƒç´ å°çŒ« -->
  <img id="catImg" src="img/cat_idle.png" width="140" style="display:block;margin-bottom:10px">

  <!-- è¿›åº¦æ¡ -->
  <div class="bars">
    æœä»åº¦ <div class="bar-bg"><div id="barObey" class="bar-fill"></div></div>
    è„¸çº¢åº¦ <div class="bar-bg"><div id="barBlush" class="bar-fill"></div></div>
  </div>

  <p>ğŸ§â€â™€ï¸ çŠ¶æ€ï¼š<span id="status">ç­‰å¾…ä¸»äººæŒ‡ä»¤</span></p>

  <!-- æŒ‡ä»¤æŒ‰é’® -->
  <button onclick="askConfirm('å¼ å˜´')">å¼ å˜´</button>
  <button onclick="askConfirm('å¤¹ç´§10ç§’')">å¤¹ç´§10ç§’</button>
  <button onclick="askConfirm('ä¸å‡†å°„')">ä¸å‡†å°„</button>
  <button onclick="askConfirm('èˆ”è„šè¶¾')">èˆ”è„šè¶¾</button>

  <!-- å¾½ç« åŒº -->
  <div id="badgeArea" style="margin:10px 0"></div>

  <!-- æ—¥å¿— -->
  <div id="log" style="margin-top:10px;max-height:200px;overflow-y:auto"></div>
</div>

<!-- ç¡®è®¤æ¡† -->
<div id="confirmMask" class="mask" style="display:none;">
  <div class="confirmWindow">
    <h3 id="cmdTitle">æ‰§è¡ŒæŒ‡ä»¤</h3>
    <p id="countdown">5</p>
    <button onclick="submitChoice(true)">æœä»</button>
    <button onclick="submitChoice(false)">è¿æŠ—</button>
  </div>
</div>

<!-- é»‘å±æƒ©ç½š -->
<div id="punishMask" class="mask" style="display:none;">
  <div class="punishWindow">
    <h3>è¿ä»¤æƒ©ç½š</h3>
    <p id="punishTimer">30</p>
  </div>
</div>

<script>
/* ---------- å…¨å±€æ•°æ® ---------- */
let obey=0, blush=0, lickCnt=0, clampCnt=0, violateCnt=0;
let pendingCmd='', cd=0, cdTimer, punishTimer;
let combo=[], lastCombo='';

/* ---------- æˆå°±å­—å…¸ ---------- */
const ACH = {
  obey10:   {u:false, icon:'img/badge_obey10.png',  check:()=> lickCnt+clampCnt>=10},
  violate1: {u:false, icon:'img/badge_violate1.png',check:()=> violateCnt>=1},
  blush100: {u:false, icon:'img/badge_blush100.png',check:()=> blush===100},
  combo3:   {u:false, icon:'img/badge_combo3.png',  check:()=> lastCombo==='å¼ å˜´>å¤¹ç´§10ç§’>ä¸å‡†å°„'}
};

/* ---------- DOM ç¼“å­˜ ---------- */
const gate=document.getElementById('gate'), panel=document.getElementById('panel');
const obeyBar=document.getElementById('barObey'), blushBar=document.getElementById('barBlush');
const status=document.getElementById('status'), logElem=document.getElementById('log');
const catImg=document.getElementById('catImg'), badgeArea=document.getElementById('badgeArea');
const confirmMask=document.getElementById('confirmMask'), cmdTitle=document.getElementById('cmdTitle'), countdown=document.getElementById('countdown');
const punishMask=document.getElementById('punishMask'), punishTimerElem=document.getElementById('punishTimer');

/* ---------- å…¥å£å£ä»¤ ---------- */
function checkCode(){
  if(document.getElementById('code').value.trim()==='ç’ƒï¼Œæˆ‘å·²å°±ç»ª'){
    gate.style.display='none'; panel.style.display='block';
  }else alert('å£ä»¤é”™è¯¯ï¼Œé‡è¾“ï¼');
}

/* ---------- æŒ‡ä»¤ç¡®è®¤ ---------- */
function askConfirm(cmd){
  pendingCmd=cmd; cmdTitle.textContent=`æ‰§è¡Œã€Œ${cmd}ã€ï¼Ÿ`;
  cd=5; countdown.textContent=cd; confirmMask.style.display='flex';
  cdTimer=setInterval(()=>{cd--; countdown.textContent=cd;
    if(cd===0){clearInterval(cdTimer);submitChoice(false);} },1000);
}
function submitChoice(obeyChoice){
  clearInterval(cdTimer); confirmMask.style.display='none';
  obeyChoice ? doObey(pendingCmd) : doPunish('è¿æŠ—ï¼š'+pendingCmd);
}

/* ---------- æœä» ---------- */
function doObey(cmd){
  addLog('æœä»ï¼š'+cmd); status.textContent='æ‰§è¡Œä¸­ï¼š'+cmd;
  /* è®¡æ•° & å°çŒ«åŠ¨ä½œ */
  if(cmd.includes('å¼ å˜´')||cmd.includes('èˆ”')){ lickCnt++; catImg.src='img/cat_lick.png'; }
  if(cmd.includes('å¤¹')){ clampCnt++; catImg.src='img/cat_clamp.png'; }
  /* è¿æ‹›åˆ¤å®š */
  combo.push(cmd); if(combo.length>3) combo.shift();
  if(combo.join('>')==='å¼ å˜´>å¤¹ç´§10ç§’>ä¸å‡†å°„') lastCombo=combo.join('>');
  /* è¿›åº¦ */
  obey=Math.min(100,obey+10); blush=Math.min(100,blush+5); updateBars(); checkAch();
}

/* ---------- è¿æŠ— ---------- */
function doPunish(msg){
  violateCnt++; addLog(msg); status.textContent='æƒ©ç½šä¸­'; checkAch();
  punishMask.style.display='flex'; let t=30; punishTimerElem.textContent=t;
  punishTimer=setInterval(()=>{t--; punishTimerElem.textContent=t;
    if(t===0){clearInterval(punishTimer); punishMask.style.display='none'; status.textContent='ç­‰å¾…æŒ‡ä»¤';}},1000);
}

/* ---------- è¿›åº¦æ¡ ---------- */
function updateBars(){
  obeyBar.style.width=obey+'%'; blushBar.style.width=blush+'%';
  const clr=blush<50?'#66c':(blush<80?'#f79':'#f22'); obeyBar.style.background=clr; blushBar.style.background='#f38';
}

/* ---------- æˆå°±æ£€æŸ¥ & æ˜¾ç¤º ---------- */
function checkAch(){
  for(const k in ACH){
    const a=ACH[k]; if(!a.u && a.check()){ a.u=true; showBadge(a.icon); }
  }
}
function showBadge(icon){
  const img=document.createElement('img'); img.src=icon; badgeArea.appendChild(img);
  addLog('ğŸ– æˆå°±è§£é”!');            // åŒæ—¶å†™æ—¥å¿—
}

/* ---------- æ—¥å¿— ---------- */
function addLog(txt){
  const p=document.createElement('p'); p.textContent=txt; logElem.appendChild(p);
}
</script>
</body>
</html>
