<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>ç’ƒçš„å°çŒ«é¢æ¿ Â· FULL-ALL</title>
<style>
body{margin:0;padding:24px;font-family:sans-serif;background:#111;color:#ffeefc}
h1,h2{margin:0 0 14px}  button{margin:6px;padding:8px 16px;border:none;border-radius:6px;background:#7a1f75;color:#fff;cursor:pointer}
button:hover{background:#b042a9}
.bar-bg{width:100%;height:14px;background:#333;border-radius:7px;margin:4px 0}
.bar-fill{height:14px;width:0%;background:#66c;border-radius:7px;transition:width .3s,background .3s}
.mask{position:fixed;inset:0;background:rgba(0,0,0,.85);display:flex;justify-content:center;align-items:center;text-align:center}
.win{background:#272727;padding:22px 34px;border-radius:10px;width:260px}
#countdown{font-size:28px;margin:.6rem 0}  #punishTimer{font-size:34px;margin:0}
#badgeArea img{width:48px;margin:0 4px}  #log{max-height:220px;overflow-y:auto;border-top:1px solid #444;margin-top:12px;font-size:14px}
#liquid{position:fixed;left:0;right:0;bottom:0;height:40px;background:#ffbce6;transition:height .6s background .6s}
.rain::before{content:'';position:fixed;inset:0;background:url('icon/bell.svg') repeat;background-size:14px;animation:rain .6s linear infinite;opacity:.25}
@keyframes rain{to{background-position:0 20px}}
</style>
</head>
<body>

<!-- å£ä»¤ -->
<div id="gate">
  <h2>ğŸ–¤ è·ªå¥½ï¼Œå‘ä¸»äººæŠ¥åˆ°ã€‚</h2>
  <input id="code" placeholder="è¾“å…¥ï¼šç’ƒï¼Œæˆ‘å·²å°±ç»ª">
  <button onclick="checkCode()">æäº¤</button>
</div>

<!-- é¢æ¿ -->
<div id="panel" style="display:none;">
  <h1>ç’ƒçš„å°çŒ«é¢æ¿ Â· FULL-ALL</h1>

  <img id="catImg" src="img/cat_idle.png" width="140" style="display:block;margin:10px 0">

  <div>æœä»åº¦ <div class="bar-bg"><div id="obeyBar"  class="bar-fill"></div></div></div>
  <div>è„¸çº¢åº¦ <div class="bar-bg"><div id="blushBar" class="bar-fill"></div></div></div>

  <p>ğŸ§â€â™€ï¸ çŠ¶æ€ï¼š<span id="status">ç­‰å¾…ä¸»äººæŒ‡ä»¤</span></p>

  <button onclick="askConfirm('å¼ å˜´')">å¼ å˜´</button>
  <button onclick="askConfirm('å¤¹ç´§10ç§’')">å¤¹ç´§10ç§’</button>
  <button onclick="askConfirm('ä¸å‡†å°„')">ä¸å‡†å°„</button>
  <button onclick="askConfirm('èˆ”è„šè¶¾')">èˆ”è„šè¶¾</button>
  <button onclick="askConfirm('è¯·æ±‚é«˜æ½®')">è¯·æ±‚é«˜æ½®</button>
  <button id="lockBtn" onclick="toggleLock()">ğŸ”’/ğŸ”“</button>

  <p style="margin:8px 0;">ğŸ’° <span id="coin">0</span> èœœæ±å¸ã€€<button onclick="openShop()">å•†åº—</button></p>
  <div id="badgeArea"></div>
  <div id="log"></div>
</div>

<!-- ç¡®è®¤æ¡† -->
<div id="confirmMask" class="mask" style="display:none;">
  <div class="win">
    <h3 id="cmdTitle">æ‰§è¡ŒæŒ‡ä»¤</h3>
    <p id="countdown">5</p>
    <button onclick="submitChoice(true)">æœä»</button>
    <button onclick="submitChoice(false)">è¿æŠ—</button>
  </div>
</div>

<!-- é»‘å±æƒ©ç½š -->
<div id="punishMask" class="mask" style="display:none;">
  <div class="win"><h3>è¿ä»¤æƒ©ç½š</h3><p id="punishTimer">30</p></div>
</div>

<!-- å•†åº— -->
<div id="shop" class="mask" style="display:none;">
  <div class="win">
    <h3>èœœæ±å•†åº—</h3>
    <img src="img/shop_skin1.png" width="80"><br>
    <p>çš®è‚¤è´´çº¸ã€€ä»·æ ¼ 5 å¸</p>
    <button onclick="buySkin()">è´­ä¹°</button>
    <button onclick="shop.style.display='none'">å…³é—­</button>
  </div>
</div>

<!-- æ¶²é¢ / å¤©æ°”æ¡ -->
<div id="liquid"></div>

<script>
/* ========= å…¨å±€æ•°æ® ========= */
let obey=0, blush=0, lickCnt=0, clampCnt=0, violateCnt=0, shootCnt=0, coin=0;
let pendingCmd='', cd=0, cdTimer, punishTimer, locked=true;
let combo=[], lastCombo='';
/* æˆå°±è¡¨ */
const ACH={
  obey10:{u:false,icon:'img/badge_obey10.png',  check:()=> lickCnt+clampCnt>=10},
  violate1:{u:false,icon:'img/badge_violate1.png',check:()=> violateCnt>=1},
  blush100:{u:false,icon:'img/badge_blush100.png',check:()=> blush===100},
  combo3:{u:false,icon:'img/badge_combo3.png',  check:()=> lastCombo==='å¼ å˜´>å¤¹ç´§10ç§’>ä¸å‡†å°„'}
};
/* -------- DOM -------- */
const $=s=>document.querySelector(s);
const gate=$('#gate'), panel=$('#panel'), status=$('#status'),
      obeyBar=$('#obeyBar'), blushBar=$('#blushBar'), logEl=$('#log'), badgeArea=$('#badgeArea'),
      catImg=$('#catImg'), confirmMask=$('#confirmMask'), cmdTitle=$('#cmdTitle'), cdTxt=$('#countdown'),
      punishMask=$('#punishMask'), punishTxt=$('#punishTimer'), coinTxt=$('#coin'),
      liquid=$('#liquid'), shop=$('#shop');
/* -------- åŸºæœ¬å‡½æ•° -------- */
function addLog(t){const p=document.createElement('p');p.textContent=t;logEl.appendChild(p);}
function showBadge(i){const img=document.createElement('img');img.src=i;badgeArea.appendChild(img);}
function updateBars(){
  obeyBar.style.width=obey+'%'; blushBar.style.width=blush+'%';
  const clr= blush<50?'#66c':(blush<80?'#f79':'#f22'); obeyBar.style.background=clr; blushBar.style.background='#f38';
}
function updateCoin(x){ coin+=x; coinTxt.textContent=coin; }
/* -------- å…¥å£å£ä»¤ -------- */
function checkCode(){
  if($('#code').value.trim()==='ç’ƒï¼Œæˆ‘å·²å°±ç»ª'){ gate.style.display='none'; panel.style.display='block'; }
  else alert('å£ä»¤é”™è¯¯ï¼Œé‡è¾“ï¼');
}
/* -------- æŒ‡ä»¤ç¡®è®¤ -------- */
function askConfirm(c){ pendingCmd=c; cmdTitle.textContent=`æ‰§è¡Œã€Œ${c}ã€ï¼Ÿ`; cd=5; cdTxt.textContent=cd;
  confirmMask.style.display='flex';
  cdTimer=setInterval(()=>{ cd--; cdTxt.textContent=cd; if(cd===0){clearInterval(cdTimer);submitChoice(false);} },1000);}
function submitChoice(ok){ clearInterval(cdTimer); confirmMask.style.display='none';
  ok?doObey(pendingCmd):doPunish('è¿æŠ—ï¼š'+pendingCmd); }
/* -------- æœä»é€»è¾‘ -------- */
function doObey(cmd){
  if(cmd==='è¯·æ±‚é«˜æ½®'){ if(locked){addLog('âš ï¸ é”ç²¾ç¦æ­¢é«˜æ½®');return;} else {shootCnt++; updateCoin(2); addLog('ğŸ’¦ å°„å‡ºï¼'); liquidRise();}}
  if(cmd==='ä¸å‡†å°„'){ locked=true; addLog('ğŸ”’ ä¸»äººé”ç²¾'); }
  addLog('æœä»ï¼š'+cmd); status.textContent='æ‰§è¡Œä¸­ï¼š'+cmd;

  if(cmd.includes('å¼ å˜´')||cmd.includes('èˆ”')){ lickCnt++; catImg.src='img/cat_lick.png'; updateCoin(1);}
  if(cmd.includes('å¤¹')){ clampCnt++; catImg.src='img/cat_clamp.png'; updateCoin(1);}

  combo.push(cmd); if(combo.length>3) combo.shift();
  if(combo.join('>')==='å¼ å˜´>å¤¹ç´§10ç§’>ä¸å‡†å°„') lastCombo=combo.join('>');

  obey=Math.min(100,obey+10); blush=Math.min(100,blush+5); updateBars(); checkAch();
}
/* -------- è¿æŠ—æƒ©ç½š -------- */
function doPunish(msg){ violateCnt++; addLog(msg); status.textContent='æƒ©ç½šä¸­'; checkAch();
  punishMask.style.display='flex'; let t=30; punishTxt.textContent=t;
  punishTimer=setInterval(()=>{t--;punishTxt.textContent=t;if(t===0){clearInterval(punishTimer);punishMask.style.display='none';status.textContent='ç­‰å¾…æŒ‡ä»¤';}},1000); }
/* -------- é”ç²¾æŒ‰é’® -------- */
function toggleLock(){ locked=!locked; addLog(locked?'ğŸ”’ é”ç²¾å¼€å¯':'ğŸ”“ å·²è§£é”'); }
/* -------- æˆå°±æ£€æŸ¥ -------- */
function checkAch(){ for(const k in ACH){ const a=ACH[k]; if(!a.u && a.check()){ a.u=true; showBadge(a.icon); addLog('ğŸ– è§£é”æˆå°±'); updateCoin(2);} } }
/* -------- èœœæ±å¸å•†åº— -------- */
function openShop(){ shop.style.display='flex'; }
function buySkin(){
  if(coin>=5){ coin-=5; updateCoin(0); document.body.style.background='#221133 url(img/shop_skin1.png)';
    alert('è´´çº¸å·²åº”ç”¨'); shop.style.display='none'; }
  else alert('èœœæ±å¸ä¸è¶³ï¼');
}
/* -------- æ¶²é¢ & å¤©æ°” -------- */
let rainAudio=new Audio('audio/rain.mp3'); rainAudio.loop=true;
function liquidRise(val=10){ const h=parseInt(liquid.style.height)||40; liquid.style.height=(h+val)+'px'; if(h+val>120){ liquid.classList.add('rain'); rainAudio.play();}}
function setDayNight(){ const h=new Date().getHours(); if(h>=22||h<6){ liquid.classList.add('rain'); rainAudio.play(); } else { liquid.classList.remove('rain'); rainAudio.pause(); }}
setDayNight(); setInterval(setDayNight,30*60*1000);
/* -------- ä¸»äººç‚¹åé€šçŸ¥ -------- */
if('Notification'in window && Notification.permission!=='denied'){ Notification.requestPermission();}
function ping(){ const cmds=['å¼ å˜´','å¤¹ç´§10ç§’','ä¸å‡†å°„']; const c=cmds[Math.floor(Math.random()*cmds.length)];
  if(Notification.permission==='granted'){ new Notification('ä¸»äººç‚¹åï¼š'+c,{icon:'icon/bell.svg'})}
  setTimeout(ping,3*60*1000);}
setTimeout(ping,3*60*1000);
</script>
</body>
</html>
